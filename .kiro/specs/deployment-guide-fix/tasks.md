# 实施计划

- [x] 1. 创建备份和分析工具


  - 创建备份脚本，在删除前保存当前的 systemd 配置
  - 编写部署分析脚本，识别现有的 systemd 服务和 cron 作业
  - 实施配置验证工具，确保正确的 cron 设置
  - _需求: 1.1, 6.1_

- [x] 2. 从 deploy.sh 中删除 systemd 服务创建


  - 从 deploy.sh 中删除 `create_systemd_service()` 函数
  - 从部署脚本中删除所有 systemctl 命令
  - 更新部署流程以跳过 systemd 服务设置
  - 修改部署验证以检查 cron 作业而不是 systemd 服务
  - _需求: 1.2, 2.3_

- [x] 3. 更新监控脚本以删除 systemd 依赖


  - 修改 `scripts/monitor.sh` 以删除基于 systemctl 的服务检查
  - 实施基于进程的监控，检查运行中的 Python 进程
  - 更新健康检查逻辑，通过日志分析验证 cron 作业执行
  - 添加不依赖 systemd 服务状态的网络连接检查
  - _需求: 2.3, 5.3_

- [x] 4. 增强 deploy.sh 中的 cron 作业配置



  - 改进 `setup_cron_jobs()` 函数以处理多知识库配置
  - 为 cron 作业创建添加适当的错误处理和验证
  - 为不同知识库的 cron 作业实施单独的日志记录
  - 为单知识库和多知识库部署创建 cron 作业模板
  - _需求: 3.1, 3.2, 3.3_

- [x] 5. 创建全面的基于 cron 的监控系统


  - 开发专注于 cron 作业执行状态的新监控脚本
  - 实施日志文件分析以检测成功和失败的同步
  - 添加磁盘空间监控和 cron 日志的自动轮转
  - 创建适用于计划执行模型的健康检查工具
  - _需求: 4.1, 4.2, 5.1_

- [x] 6. 重构 DEPLOYMENT_GUIDE.md 以删除 systemd 部分



  - 删除整个"系统服务配置"部分
  - 从使用说明中删除所有 systemctl 命令
  - 从监控部分删除基于 systemd 的监控引用
  - 更新部署检查清单以删除 systemd 相关项目
  - _需求: 1.1, 1.2, 2.3_

- [x] 7. 在 DEPLOYMENT_GUIDE.md 中添加部署方法的清晰解释


  - 添加新部分解释为什么 cron 调度是正确的方法
  - 记录为什么带有 Restart=always 的 systemd 守护进程模式不合适
  - 包含显示正确执行流程的架构图
  - 添加特定于基于 cron 执行的故障排除部分
  - _需求: 2.1, 2.2_

- [x] 8. 增强多知识库 cron 配置文档



  - 用详细的 cron 示例扩展多知识库部分
  - 为不同调度场景添加配置模板
  - 记录避免调度冲突的最佳实践
  - 包含多知识库的日志分离策略
  - _需求: 3.1, 3.2, 3.3_

- [x] 9. 更新故障排除部分以处理 cron 特定问题



  - 用 cron 特定的调试步骤替换 systemd 故障排除
  - 添加常见的 cron 执行问题和解决方案
  - 包含 cron 作业调试的日志分析技术
  - 记录特定于 cron 执行的权限问题
  - _需求: 4.2, 4.3_

- [x] 10. 为现有部署创建迁移工具



  - 编写迁移脚本以安全删除现有的 systemd 服务
  - 创建配置转换器以从 systemd 迁移到 cron 设置
  - 实施验证工具以验证成功迁移
  - 在迁移问题情况下添加回滚程序
  - _需求: 6.2, 6.3_

- [x] 11. 为 cron 执行实施增强的日志记录


  - 更新 cron 作业模板以包含适当的输出重定向
  - 为不同知识库同步创建单独的日志文件
  - 使用 logrotate 实施日志轮转配置
  - 添加时间戳和执行状态日志记录以便更好地调试
  - _需求: 4.1, 4.2_

- [x] 12. 更新 scripts/status.sh 以删除 systemctl 依赖


  - 从状态脚本中删除所有 systemctl 状态检查
  - 使用 pgrep 和 ps 命令实施基于进程的状态检查
  - 通过检查 crontab 条目添加 cron 作业状态验证
  - 包含日志文件分析以显示最近的执行状态
  - _需求: 2.3, 5.3_

- [x] 13. 为基于 cron 的部署创建全面的测试套件



  - 编写自动化测试以验证 cron 作业创建和配置
  - 为多知识库调度场景实施测试
  - 为日志文件生成和轮转创建验证测试
  - 为完整的基于 cron 的部署流程添加集成测试
  - _需求: 1.3, 3.3, 4.3_

- [x] 14. 更新部署验证和最终说明


  - 修改部署完成消息以专注于 cron 验证
  - 更新验证步骤以检查 cron 作业而不是 systemd 服务
  - 修订"下一步"说明以删除 systemctl 命令
  - 添加 cron 作业测试和验证说明
  - _需求: 1.1, 1.3, 6.1_

- [x] 15. 为 cron 日志创建 logrotate 配置


  - 为所有 cron 日志文件编写 logrotate 配置文件
  - 实施旧日志文件的自动清理
  - 为日志管理添加压缩和保留策略
  - 将 logrotate 设置集成到部署脚本中
  - _需求: 5.2, 4.1_

- [x] 16. 最终集成和文档更新



  - 更新文档中的所有交叉引用以反映基于 cron 的方法
  - 确保所有脚本和配置文件的一致性
  - 创建专注于 cron 设置的部署验证检查清单
  - 为基于 cron 的执行添加性能优化建议
  - _需求: 6.1, 6.2, 6.3_