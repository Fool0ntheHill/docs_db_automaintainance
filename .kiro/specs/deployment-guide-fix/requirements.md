# 需求文档

## 项目介绍

当前的 DEPLOYMENT_GUIDE.md 存在严重的逻辑矛盾，同时描述了两种互相冲突的部署和运行方式：systemd 服务（常驻模式）和 cron 定时任务。这会导致用户困惑，并可能造成错误的部署，使同步脚本陷入无限重启循环，而不是按计划间隔执行一次后退出。本规范旨在通过建立清晰、单一的部署方法来修复这些矛盾，该方法与脚本"运行一次后退出"的预期行为一致。

## 需求

### 需求 1

**用户故事：** 作为部署 TKE 文档同步系统的系统管理员，我希望有一个清晰明确的部署指南，只描述正确的部署方法，这样我就可以毫无困惑地部署系统。

#### 验收标准

1. 当我阅读部署指南时，系统应该只描述一种部署方法（基于 cron 的调度）
2. 当我按照部署说明操作时，系统不应包含任何会导致持续重启的 systemd 服务配置
3. 当我完成部署时，同步脚本应该只在计划的时间间隔运行并在完成后退出

### 需求 2

**用户故事：** 作为维护部署文档的开发者，我希望指南清楚地解释为什么 cron 调度是正确的方法，为什么 systemd 守护进程模式不合适，这样未来的维护者就能理解架构决策。

#### 验收标准

1. 当我阅读部署指南时，系统应该包含为什么 cron 调度是正确方法的清晰解释
2. 当我查看文档时，系统应该解释为什么带有 Restart=always 的 systemd 守护进程模式不适合这个用例
3. 当我检查指南时，系统应该删除所有对 systemd 服务配置和依赖 systemd 的监控脚本的引用

### 需求 3

**用户故事：** 作为部署多个知识库的用户，我希望有清晰的说明来为不同的知识库配置设置 cron 作业，这样我就可以适当地安排同步任务。

#### 验收标准

1. 当我配置多个知识库时，系统应该为每个知识库提供清晰的 cron 配置示例
2. 当我设置计划任务时，系统应该包含 cron 作业的适当日志配置
3. 当我安排不同的知识库时，系统应该推荐适当的时间间隔以避免冲突

### 需求 4

**用户故事：** 作为系统管理员，我希望部署指南包含基于 cron 执行的适当错误处理和日志记录，这样我就可以有效地监控和排除同步过程的故障。

#### 验收标准

1. 当我配置 cron 作业时，系统应该包含适当的输出重定向到日志文件
2. 当计划执行期间发生错误时，系统应该在单独的日志文件中捕获 stdout 和 stderr
3. 当我需要排除故障时，系统应该提供查看和分析 cron 作业日志的清晰说明

### 需求 5

**用户故事：** 作为遵循部署指南的用户，我希望所有监控和维护说明都与基于 cron 的方法一致，这样我就不会遇到不兼容的基于 systemd 的监控引用。

#### 验收标准

1. 当我阅读监控说明时，系统应该提供与 cron 兼容的监控方法
2. 当我设置日志轮转时，系统应该包含 logrotate 配置而不是基于 systemd 的日志管理
3. 当我配置健康检查时，系统应该使用基于 cron 的健康监控而不是 systemd 服务监控

### 需求 6

**用户故事：** 作为部署系统的用户，我希望部署指南保留所有有价值的配置信息，同时删除矛盾的 systemd 部分，这样我仍然可以从全面的设置说明中受益。

#### 验收标准

1. 当我遵循部署指南时，系统应该保留所有环境设置、依赖安装和配置部分
2. 当我配置系统时，系统应该保留所有 Dify API 配置和多知识库设置说明
3. 当我完成部署时，系统应该保留所有适用于基于 cron 执行的故障排除信息